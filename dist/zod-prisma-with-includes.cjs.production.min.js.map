{"version":3,"file":"zod-prisma-with-includes.cjs.production.min.js","sources":["../src/config.ts","../src/util.ts","../src/docs.ts","../src/types.ts","../src/module.ts","../src/index.ts","../src/generator.ts"],"sourcesContent":["import { z } from 'zod'\n\nconst configBoolean = z.enum(['true', 'false']).transform((arg) => JSON.parse(arg))\n\nexport const configSchema = z.object({\n\trelationModel: configBoolean.default('true').or(z.literal('default')),\n\tmodelSuffix: z.string().default('Model'),\n\tmodelCase: z.enum(['PascalCase', 'camelCase']).default('PascalCase'),\n\tuseDecimalJs: configBoolean.default('false'),\n\timports: z.string().optional(),\n\tprismaJsonNullability: configBoolean.default('true'),\n})\n\nexport type Config = z.infer<typeof configSchema>\n\nexport type PrismaOptions = {\n\tschemaPath: string\n\toutputPath: string\n\tclientPath: string\n}\n\nexport type Names = {\n\tmodel: string\n\trelated: string\n}\n","import { DMMF } from '@prisma/generator-helper'\nimport type { CodeBlockWriter } from 'ts-morph'\nimport { Config } from './config'\n\nexport const writeArray = (writer: CodeBlockWriter, array: string[], newLine = true) =>\n\tarray.forEach((line) => writer.write(line).conditionalNewLine(newLine))\n\nexport const useModelNames = ({ modelCase, modelSuffix, relationModel }: Config) => {\n\tconst formatModelName = (name: string, prefix = '') => {\n\t\tif (modelCase === 'camelCase') {\n\t\t\tname = name.slice(0, 1).toLowerCase() + name.slice(1)\n\t\t}\n\t\treturn `${prefix}${name}${modelSuffix}`\n\t}\n\n\treturn {\n\t\tmodelName: (name: string) => formatModelName(name, relationModel === 'default' ? '_' : ''),\n\t\trelatedModelName: (name: string | DMMF.SchemaEnum | DMMF.OutputType | DMMF.SchemaArg) =>\n\t\t\tformatModelName(\n\t\t\t\trelationModel === 'default' ? name.toString() : `Related${name.toString()}`\n\t\t\t),\n\t\tsimpleRelatedModelName: (\n\t\t\tname: string | DMMF.SchemaEnum | DMMF.OutputType | DMMF.SchemaArg\n\t\t) =>\n\t\t\tformatModelName(\n\t\t\t\trelationModel === 'default'\n\t\t\t\t\t? `Simple${name.toString()}`\n\t\t\t\t\t: `SimpleRelated${name.toString()}`\n\t\t\t),\n\t}\n}\n\nexport const needsRelatedModel = (model: DMMF.Model, config: Config) =>\n\tmodel.fields.some((field) => field.kind === 'object') && config.relationModel !== false\n\nexport const chunk = <T extends any[]>(input: T, size: number): T[] => {\n\treturn input.reduce((arr, item, idx) => {\n\t\treturn idx % size === 0\n\t\t\t? [...arr, [item]]\n\t\t\t: [...arr.slice(0, -1), [...arr.slice(-1)[0], item]]\n\t}, [])\n}\n\nexport const dotSlash = (input: string) => {\n\tconst converted = input\n\t\t.replace(/^\\\\\\\\\\?\\\\/, '')\n\t\t.replace(/\\\\/g, '/')\n\t\t.replace(/\\/\\/+/g, '/')\n\n\tif (converted.includes(`/node_modules/`)) return converted.split(`/node_modules/`).slice(-1)[0]\n\n\tif (converted.startsWith(`../`)) return converted\n\n\treturn './' + converted\n}\n","import { ArrayTree, parse, stringify } from 'parenthesis'\nimport { chunk } from './util'\n\nexport const getJSDocs = (docString?: string) => {\n\tconst lines: string[] = []\n\n\tif (docString) {\n\t\tconst docLines = docString.split('\\n').filter((dL) => !dL.trimStart().startsWith('@zod'))\n\n\t\tif (docLines.length) {\n\t\t\tlines.push('/**')\n\t\t\tdocLines.forEach((dL) => lines.push(` * ${dL}`))\n\t\t\tlines.push(' */')\n\t\t}\n\t}\n\n\treturn lines\n}\n\nexport const getZodDocElements = (docString: string) =>\n\tdocString\n\t\t.split('\\n')\n\t\t.filter((line) => line.trimStart().startsWith('@zod'))\n\t\t.map((line) => line.trimStart().slice(4))\n\t\t.flatMap((line) =>\n\t\t\t// Array.from(line.matchAll(/\\.([^().]+\\(.*?\\))/g), (m) => m.slice(1)).flat()\n\t\t\tchunk(parse(line), 2)\n\t\t\t\t.slice(0, -1)\n\t\t\t\t.map(\n\t\t\t\t\t([each, contents]) =>\n\t\t\t\t\t\t(each as string).replace(/\\)?\\./, '') +\n\t\t\t\t\t\t`${stringify(contents as ArrayTree)})`\n\t\t\t\t)\n\t\t)\n\nexport const computeCustomSchema = (docString: string) => {\n\treturn getZodDocElements(docString)\n\t\t.find((modifier) => modifier.startsWith('custom('))\n\t\t?.slice(7)\n\t\t.slice(0, -1)\n}\n\nexport const computeModifiers = (docString: string) => {\n\treturn getZodDocElements(docString).filter((each) => !each.startsWith('custom('))\n}\n","import type { DMMF } from '@prisma/generator-helper'\nimport { computeCustomSchema, computeModifiers } from './docs'\n\nexport const getZodConstructor = (\n\tfield: DMMF.Field,\n\tgetRelatedModelName = (name: string | DMMF.SchemaEnum | DMMF.OutputType | DMMF.SchemaArg) =>\n\t\tname.toString()\n) => {\n\tlet zodType = 'z.unknown()'\n\tlet extraModifiers: string[] = ['']\n\tif (field.kind === 'scalar') {\n\t\tswitch (field.type) {\n\t\t\tcase 'String':\n\t\t\t\tzodType = 'z.string()'\n\t\t\t\tbreak\n\t\t\tcase 'Int':\n\t\t\t\tzodType = 'z.number()'\n\t\t\t\textraModifiers.push('int()')\n\t\t\t\tbreak\n\t\t\tcase 'BigInt':\n\t\t\t\tzodType = 'z.bigint()'\n\t\t\t\tbreak\n\t\t\tcase 'DateTime':\n\t\t\t\tzodType = 'z.date()'\n\t\t\t\tbreak\n\t\t\tcase 'Float':\n\t\t\t\tzodType = 'z.number()'\n\t\t\t\tbreak\n\t\t\tcase 'Decimal':\n\t\t\t\tzodType = 'z.number()'\n\t\t\t\tbreak\n\t\t\tcase 'Json':\n\t\t\t\tzodType = 'jsonSchema'\n\t\t\t\tbreak\n\t\t\tcase 'Boolean':\n\t\t\t\tzodType = 'z.boolean()'\n\t\t\t\tbreak\n\t\t\t// TODO: Proper type for bytes fields\n\t\t\tcase 'Bytes':\n\t\t\t\tzodType = 'z.unknown()'\n\t\t\t\tbreak\n\t\t}\n\t} else if (field.kind === 'enum') {\n\t\tzodType = `z.nativeEnum(${field.type})`\n\t} else if (field.kind === 'object') {\n\t\tzodType = getRelatedModelName(field.type)\n\t}\n\n\tif (field.isList) extraModifiers.push('array()')\n\tif (field.documentation) {\n\t\tzodType = computeCustomSchema(field.documentation) ?? zodType\n\t\textraModifiers.push(...computeModifiers(field.documentation))\n\t}\n\tif (!field.isRequired && field.type !== 'Json') extraModifiers.push('nullish()')\n\t// if (field.hasDefaultValue) extraModifiers.push('optional()')\n\n\treturn `${zodType}${extraModifiers.join('.')}`\n}\n","import z, { ZodLazy, ZodTypeAny } from 'zod'\nimport _ from 'lodash'\n\nexport function with_includes(\n\tschemas: any,\n\tschemaObj: Record<any, any>,\n\tincludes: Record<string, any>\n) {\n\tconst [name_schema] = obj_first_property(schemaObj)\n\tconst data = get_related_shape(schemas, name_schema)\n\tlet new_schema = data.core_shape\n\tObject.entries(includes).forEach(([key, el]) => {\n\t\tif (!data.simple_related_zod_schema.hasOwnProperty(key)) return\n\t\tconst [name_schema1] = obj_first_property(data.simple_related_zod_schema[key]?.shape)\n\t\tif (typeof el === 'boolean') {\n\t\t\tnew_schema[key] = data.simple_related_zod_schema[key].array\n\t\t\t\t? schemas[name_schema1].array()\n\t\t\t\t: schemas[name_schema1]\n\t\t} else if (typeof el === 'object') {\n\t\t\tnew_schema[key] = with_includes(\n\t\t\t\tschemas,\n\t\t\t\t{ [name_schema1]: schemas[name_schema1] },\n\t\t\t\tincludes[key].include\n\t\t\t)\n\t\t}\n\t})\n\treturn z.object(new_schema)\n}\n\nconst obj_first_property = (obj: Record<any, any>) => {\n\tconst obj_keys = Object.keys(obj)\n\tconst name = obj_keys.length === 1 ? obj_keys[0] : null\n\tif (!name) throw new Error(`schemaObj не може бути пустим обєктом`)\n\treturn [name, obj[name]]\n}\n\nconst get_related_shape = (schemas: any, name_schema: any) => {\n\tconst core_zod_schema = schemas[name_schema]\n\ttype core_zod_shape_type = ReturnType<typeof core_zod_schema._def.shape>\n\tconst core_zod_shape = core_zod_schema._def.shape() as core_zod_shape_type\n\tconst core_zod_schema_keys = Object.keys(core_zod_shape)\n\tconst related_zod_schema = schemas[`Related${name_schema}`] as ZodLazy<ZodTypeAny>\n\tconst simple_related_zod_schema = schemas[`SimpleRelated${name_schema}`] as any\n\tconst full_shape = related_zod_schema._def.getter()._def.shape() as Record<any, any>\n\tconst core_shape = _.pick(full_shape, core_zod_schema_keys)\n\tconst related_shape = _.omit(full_shape, core_zod_schema_keys)\n\treturn {\n\t\tcore_zod_schema,\n\t\tfull_shape,\n\t\tcore_shape,\n\t\trelated_shape,\n\t\tsimple_related_zod_schema,\n\t}\n}\n","// @ts-ignore Importing package.json for automated synchronization of version numbers\nimport { version } from '../package.json'\n\nimport { generatorHandler } from '@prisma/generator-helper'\nimport { SemicolonPreference } from 'typescript'\nimport { configSchema, PrismaOptions } from './config'\nimport { populateModelFile, generateBarrelFile } from './generator'\nimport { Project } from 'ts-morph'\nexport {with_includes} from './module'\n\ngeneratorHandler({\n\tonManifest() {\n\t\treturn {\n\t\t\tversion,\n\t\t\tprettyName: 'Zod Schemas',\n\t\t\tdefaultOutput: 'zod',\n\t\t}\n\t},\n\tonGenerate(options) {\n\t\tconst project = new Project()\n\n\t\tconst models = options.dmmf.datamodel.models\n\n\t\tconst { schemaPath } = options\n\t\tconst outputPath = options.generator.output!.value\n\t\tconst clientPath = options.otherGenerators.find(\n\t\t\t(each) => each.provider.value === 'prisma-client-js'\n\t\t)!.output!.value!\n\n\t\tconst results = configSchema.safeParse(options.generator.config)\n\t\tif (!results.success)\n\t\t\tthrow new Error(\n\t\t\t\t'Incorrect config provided. Please check the values you provided and try again.'\n\t\t\t)\n\n\t\tconst config = results.data\n\t\tconst prismaOptions: PrismaOptions = {\n\t\t\tclientPath,\n\t\t\toutputPath,\n\t\t\tschemaPath,\n\t\t}\n\n\t\tconst indexFile = project.createSourceFile(\n\t\t\t`${outputPath}/index.ts`,\n\t\t\t{},\n\t\t\t{ overwrite: true }\n\t\t)\n\n\t\tgenerateBarrelFile(models, indexFile)\n\n\t\tindexFile.formatText({\n\t\t\tindentSize: 2,\n\t\t\tconvertTabsToSpaces: true,\n\t\t\tsemicolons: SemicolonPreference.Remove,\n\t\t})\n\n\t\tmodels.forEach((model) => {\n\t\t\tconst sourceFile = project.createSourceFile(\n\t\t\t\t`${outputPath}/${model.name.toLowerCase()}.ts`,\n\t\t\t\t{},\n\t\t\t\t{ overwrite: true }\n\t\t\t)\n\t\t\tpopulateModelFile(model, sourceFile, config, prismaOptions)\n\n\t\t\tsourceFile.formatText({\n\t\t\t\tindentSize: 2,\n\t\t\t\tconvertTabsToSpaces: true,\n\t\t\t\tsemicolons: SemicolonPreference.Remove,\n\t\t\t})\n\t\t})\n\n\t\treturn project.save()\n\t},\n})\n","import path from 'path'\nimport { DMMF } from '@prisma/generator-helper'\nimport {\n\tImportDeclarationStructure,\n\tSourceFile,\n\tStructureKind,\n\tVariableDeclarationKind,\n} from 'ts-morph'\nimport { Config, PrismaOptions } from './config'\nimport { dotSlash, needsRelatedModel, useModelNames, writeArray } from './util'\nimport { getJSDocs } from './docs'\nimport { getZodConstructor } from './types'\n\nexport const writeImportsForModel = (\n\tmodel: DMMF.Model,\n\tsourceFile: SourceFile,\n\tconfig: Config,\n\t{ schemaPath, outputPath, clientPath }: PrismaOptions\n) => {\n\tconst { relatedModelName, modelName } = useModelNames(config)\n\tconst importList: ImportDeclarationStructure[] = [\n\t\t{\n\t\t\tkind: StructureKind.ImportDeclaration,\n\t\t\tnamespaceImport: 'z',\n\t\t\tmoduleSpecifier: 'zod',\n\t\t},\n\t]\n\n\tif (config.imports) {\n\t\timportList.push({\n\t\t\tkind: StructureKind.ImportDeclaration,\n\t\t\tnamespaceImport: 'imports',\n\t\t\tmoduleSpecifier: dotSlash(\n\t\t\t\tpath.relative(outputPath, path.resolve(path.dirname(schemaPath), config.imports))\n\t\t\t),\n\t\t})\n\t}\n\n\tif (config.useDecimalJs && model.fields.some((f) => f.type === 'Decimal')) {\n\t\timportList.push({\n\t\t\tkind: StructureKind.ImportDeclaration,\n\t\t\tnamedImports: ['Decimal'],\n\t\t\tmoduleSpecifier: 'decimal.js',\n\t\t})\n\t}\n\n\tconst enumFields = model.fields.filter((f) => f.kind === 'enum')\n\tconst relationFields = model.fields.filter((f) => f.kind === 'object')\n\tconst relativePath = path.relative(outputPath, clientPath)\n\n\tif (enumFields.length > 0) {\n\t\timportList.push({\n\t\t\tkind: StructureKind.ImportDeclaration,\n\t\t\tisTypeOnly: enumFields.length === 0,\n\t\t\tmoduleSpecifier: dotSlash(relativePath),\n\t\t\tnamedImports: enumFields.map((f) => f.type),\n\t\t})\n\t}\n\n\tif (config.relationModel !== false && relationFields.length > 0) {\n\t\tconst filteredFields = relationFields.filter((f) => f.type !== model.name)\n\n\t\tif (filteredFields.length > 0) {\n\t\t\timportList.push({\n\t\t\t\tkind: StructureKind.ImportDeclaration,\n\t\t\t\tmoduleSpecifier: './index',\n\t\t\t\tnamedImports: Array.from(\n\t\t\t\t\tnew Set(\n\t\t\t\t\t\tfilteredFields.flatMap((f) => [\n\t\t\t\t\t\t\tmodelName(f.type),\n\t\t\t\t\t\t\t`Complete${f.type}`,\n\t\t\t\t\t\t\trelatedModelName(f.type),\n\t\t\t\t\t\t])\n\t\t\t\t\t)\n\t\t\t\t),\n\t\t\t})\n\t\t}\n\t}\n\n\tsourceFile.addImportDeclarations(importList)\n}\n\nexport const writeTypeSpecificSchemas = (\n\tmodel: DMMF.Model,\n\tsourceFile: SourceFile,\n\tconfig: Config,\n\t_prismaOptions: PrismaOptions\n) => {\n\tif (model.fields.some((f) => f.type === 'Json')) {\n\t\tsourceFile.addStatements((writer) => {\n\t\t\twriter.newLine()\n\t\t\twriteArray(writer, [\n\t\t\t\t'// Helper schema for JSON fields',\n\t\t\t\t`type Literal = boolean | number | string${\n\t\t\t\t\tconfig.prismaJsonNullability ? '' : '| null'\n\t\t\t\t}`,\n\t\t\t\t'type Json = Literal | { [key: string]: Json } | Json[]',\n\t\t\t\t`const literalSchema = z.union([z.string(), z.number(), z.boolean()${\n\t\t\t\t\tconfig.prismaJsonNullability ? '' : ', z.null()'\n\t\t\t\t}])`,\n\t\t\t\t'const jsonSchema: z.ZodSchema<Json> = z.lazy(() => z.union([literalSchema, z.array(jsonSchema), z.record(jsonSchema)]))',\n\t\t\t])\n\t\t})\n\t}\n\n\tif (config.useDecimalJs && model.fields.some((f) => f.type === 'Decimal')) {\n\t\tsourceFile.addStatements((writer) => {\n\t\t\twriter.newLine()\n\t\t\twriteArray(writer, [\n\t\t\t\t'// Helper schema for Decimal fields',\n\t\t\t\t'z',\n\t\t\t\t'.instanceof(Decimal)',\n\t\t\t\t'.or(z.string())',\n\t\t\t\t'.or(z.number())',\n\t\t\t\t'.refine((value) => {',\n\t\t\t\t'  try {',\n\t\t\t\t'    return new Decimal(value);',\n\t\t\t\t'  } catch (error) {',\n\t\t\t\t'    return false;',\n\t\t\t\t'  }',\n\t\t\t\t'})',\n\t\t\t\t'.transform((value) => new Decimal(value));',\n\t\t\t])\n\t\t})\n\t}\n}\n\nexport const generateSchemaForModel = (\n\tmodel: DMMF.Model,\n\tsourceFile: SourceFile,\n\tconfig: Config,\n\t_prismaOptions: PrismaOptions\n) => {\n\tconst { modelName } = useModelNames(config)\n\n\tsourceFile.addVariableStatement({\n\t\tdeclarationKind: VariableDeclarationKind.Const,\n\t\tisExported: true,\n\t\tleadingTrivia: (writer) => writer.blankLineIfLastNot(),\n\t\tdeclarations: [\n\t\t\t{\n\t\t\t\tname: modelName(model.name),\n\t\t\t\tinitializer(writer) {\n\t\t\t\t\twriter\n\t\t\t\t\t\t.write('z.object(')\n\t\t\t\t\t\t.inlineBlock(() => {\n\t\t\t\t\t\t\tmodel.fields\n\t\t\t\t\t\t\t\t.filter((f) => f.kind !== 'object')\n\t\t\t\t\t\t\t\t.forEach((field) => {\n\t\t\t\t\t\t\t\t\twriteArray(writer, getJSDocs(field.documentation))\n\t\t\t\t\t\t\t\t\twriter\n\t\t\t\t\t\t\t\t\t\t.write(`${field.name}: ${getZodConstructor(field)}`)\n\t\t\t\t\t\t\t\t\t\t.write(',')\n\t\t\t\t\t\t\t\t\t\t.newLine()\n\t\t\t\t\t\t\t\t})\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.write(')')\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t})\n}\n\nexport const generateRelatedSchemaForModel = (\n\tmodel: DMMF.Model,\n\tsourceFile: SourceFile,\n\tconfig: Config,\n\t_prismaOptions: PrismaOptions\n) => {\n\tconst { modelName, relatedModelName } = useModelNames(config)\n\n\tconst relationFields = model.fields.filter((f) => f.kind === 'object')\n\n\tsourceFile.addInterface({\n\t\tname: `Complete${model.name}`,\n\t\tisExported: true,\n\t\textends: [`z.infer<typeof ${modelName(model.name)}>`],\n\t\tproperties: relationFields.map((f) => ({\n\t\t\thasQuestionToken: !f.isRequired,\n\t\t\tname: f.name,\n\t\t\ttype: `Complete${f.type}${f.isList ? '[]' : ''}${!f.isRequired ? ' | null' : ''}`,\n\t\t})),\n\t})\n\n\tsourceFile.addStatements((writer) =>\n\t\twriteArray(writer, [\n\t\t\t'',\n\t\t\t'/**',\n\t\t\t` * ${relatedModelName(\n\t\t\t\tmodel.name\n\t\t\t)} contains all relations on your model in addition to the scalars`,\n\t\t\t' *',\n\t\t\t' * NOTE: Lazy required in case of potential circular dependencies within schema',\n\t\t\t' */',\n\t\t])\n\t)\n\n\tsourceFile.addVariableStatement({\n\t\tdeclarationKind: VariableDeclarationKind.Const,\n\t\tisExported: true,\n\t\tdeclarations: [\n\t\t\t{\n\t\t\t\tname: relatedModelName(model.name),\n\t\t\t\ttype: `z.ZodSchema<Complete${model.name}>`,\n\t\t\t\tinitializer(writer) {\n\t\t\t\t\twriter\n\t\t\t\t\t\t.write(`z.lazy(() => ${modelName(model.name)}.extend(`)\n\t\t\t\t\t\t.inlineBlock(() => {\n\t\t\t\t\t\t\trelationFields.forEach((field) => {\n\t\t\t\t\t\t\t\twriteArray(writer, getJSDocs(field.documentation))\n\n\t\t\t\t\t\t\t\twriter\n\t\t\t\t\t\t\t\t\t.write(\n\t\t\t\t\t\t\t\t\t\t`${field.name}: ${getZodConstructor(\n\t\t\t\t\t\t\t\t\t\t\tfield,\n\t\t\t\t\t\t\t\t\t\t\trelatedModelName\n\t\t\t\t\t\t\t\t\t\t)}`\n\t\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t\t.write(',')\n\t\t\t\t\t\t\t\t\t.newLine()\n\t\t\t\t\t\t\t})\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.write('))')\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t})\n}\n\nexport const generateSimpleRelatedSchemaForModel = (\n\tmodel: DMMF.Model,\n\tsourceFile: SourceFile,\n\tconfig: Config,\n\t_prismaOptions: PrismaOptions\n) => {\n\tconst { modelName, simpleRelatedModelName } = useModelNames(config)\n\n\tconst relationFields = model.fields.filter((f) => f.kind === 'object')\n\n\tsourceFile.addVariableStatement({\n\t\tdeclarationKind: VariableDeclarationKind.Const,\n\t\tisExported: true,\n\t\tdeclarations: [\n\t\t\t{\n\t\t\t\tname: simpleRelatedModelName(model.name),\n\t\t\t\tinitializer(writer) {\n\t\t\t\t\twriter.inlineBlock(() => {\n\t\t\t\t\t\trelationFields.forEach((field) => {\n\t\t\t\t\t\t\twriteArray(writer, getJSDocs(field.documentation))\n\n\t\t\t\t\t\t\twriter\n\t\t\t\t\t\t\t\t.write(\n\t\t\t\t\t\t\t\t\t`${field.name}: {shape: { ${modelName(field.type)} }, array: ${\n\t\t\t\t\t\t\t\t\t\tfield.isList ? 'true' : 'false'\n\t\t\t\t\t\t\t\t\t}}`\n\t\t\t\t\t\t\t\t)\n\t\t\t\t\t\t\t\t.write(',')\n\t\t\t\t\t\t\t\t.newLine()\n\t\t\t\t\t\t})\n\t\t\t\t\t})\n\t\t\t\t},\n\t\t\t},\n\t\t],\n\t})\n}\n\nexport const populateModelFile = (\n\tmodel: DMMF.Model,\n\tsourceFile: SourceFile,\n\tconfig: Config,\n\tprismaOptions: PrismaOptions\n) => {\n\twriteImportsForModel(model, sourceFile, config, prismaOptions)\n\twriteTypeSpecificSchemas(model, sourceFile, config, prismaOptions)\n\tgenerateSchemaForModel(model, sourceFile, config, prismaOptions)\n\tif (needsRelatedModel(model, config)) {\n\t\tgenerateRelatedSchemaForModel(model, sourceFile, config, prismaOptions)\n\t\tgenerateSimpleRelatedSchemaForModel(model, sourceFile, config, prismaOptions)\n\t}\n}\n\nexport const generateBarrelFile = (models: DMMF.Model[], indexFile: SourceFile) => {\n\tmodels.forEach((model) =>\n\t\tindexFile.addExportDeclaration({\n\t\t\tmoduleSpecifier: `./${model.name.toLowerCase()}`,\n\t\t})\n\t)\n}\n"],"names":["configBoolean","z","enum","transform","arg","JSON","parse","configSchema","object","relationModel","default","or","literal","modelSuffix","string","modelCase","useDecimalJs","imports","optional","prismaJsonNullability","writeArray","writer","array","newLine","forEach","line","write","conditionalNewLine","useModelNames","formatModelName","name","prefix","slice","toLowerCase","modelName","relatedModelName","toString","simpleRelatedModelName","dotSlash","input","converted","replace","includes","split","startsWith","getJSDocs","docString","lines","docLines","filter","dL","trimStart","length","push","getZodDocElements","map","flatMap","chunk","reduce","arr","item","idx","each","contents","stringify","getZodConstructor","field","getRelatedModelName","zodType","extraModifiers","kind","type","_computeCustomSchema","_getZodDocElements$fi","isList","documentation","find","modifier","isRequired","join","obj_first_property","obj","obj_keys","Object","keys","Error","generatorHandler","onManifest","version","prettyName","defaultOutput","onGenerate","options","project","Project","models","dmmf","datamodel","schemaPath","outputPath","generator","output","value","clientPath","otherGenerators","provider","results","safeParse","config","success","data","prismaOptions","indexFile","createSourceFile","overwrite","generateBarrelFile","model","addExportDeclaration","moduleSpecifier","formatText","indentSize","convertTabsToSpaces","semicolons","SemicolonPreference","Remove","sourceFile","populateModelFile","writeImportsForModel","importList","StructureKind","ImportDeclaration","namespaceImport","path","relative","resolve","dirname","fields","some","f","namedImports","enumFields","relationFields","relativePath","isTypeOnly","filteredFields","Array","from","Set","addImportDeclarations","writeTypeSpecificSchemas","_prismaOptions","addStatements","generateSchemaForModel","addVariableStatement","declarationKind","VariableDeclarationKind","Const","isExported","leadingTrivia","blankLineIfLastNot","declarations","initializer","inlineBlock","needsRelatedModel","generateRelatedSchemaForModel","addInterface","extends","properties","hasQuestionToken","generateSimpleRelatedSchemaForModel","save","with_includes","schemas","schemaObj","name_schema","get_related_shape","core_zod_schema","core_zod_shape","_def","shape","core_zod_schema_keys","simple_related_zod_schema","full_shape","getter","core_shape","_","pick","related_shape","omit","new_schema","entries","key","el","_data$simple_related_","hasOwnProperty","name_schema1","include"],"mappings":"6UAEA,MAAMA,EAAgBC,EAAAA,EAAEC,KAAK,CAAC,OAAQ,UAAUC,WAAWC,GAAQC,KAAKC,MAAMF,KAEjEG,EAAeN,EAACA,EAACO,OAAO,CACpCC,cAAeT,EAAcU,QAAQ,QAAQC,GAAGV,EAACA,EAACW,QAAQ,YAC1DC,YAAaZ,EAAAA,EAAEa,SAASJ,QAAQ,SAChCK,UAAWd,EAAAA,EAAEC,KAAK,CAAC,aAAc,cAAcQ,QAAQ,cACvDM,aAAchB,EAAcU,QAAQ,SACpCO,QAAShB,EAACA,EAACa,SAASI,WACpBC,sBAAuBnB,EAAcU,QAAQ,UCNjCU,EAAaA,CAACC,EAAyBC,EAAiBC,GAAU,IAC9ED,EAAME,SAASC,GAASJ,EAAOK,MAAMD,GAAME,mBAAmBJ,KAElDK,EAAgBA,EAAGb,YAAWF,cAAaJ,oBACvD,MAAMoB,EAAkBA,CAACC,EAAcC,EAAS,MAC7B,cAAdhB,IACHe,EAAOA,EAAKE,MAAM,EAAG,GAAGC,cAAgBH,EAAKE,MAAM,OAE1CD,IAASD,IAAOjB,KAG3B,MAAO,CACNqB,UAAYJ,GAAiBD,EAAgBC,EAAwB,YAAlBrB,EAA8B,IAAM,IACvF0B,iBAAmBL,GAClBD,EACmB,YAAlBpB,EAA8BqB,EAAKM,WAAuB,UAAAN,EAAKM,cAEjEC,uBACCP,GAEAD,EACmB,YAAlBpB,EACY,SAAAqB,EAAKM,aACE,gBAAAN,EAAKM,cAE1B,EAcWE,EAAYC,IACxB,MAAMC,EAAYD,EAChBE,QAAQ,YAAa,IACrBA,QAAQ,MAAO,KACfA,QAAQ,SAAU,KAEpB,OAAID,EAAUE,2BAAmCF,EAAUG,wBAAwBX,OAAO,GAAG,GAEzFQ,EAAUI,kBAA0BJ,EAEjC,KAAOA,CAAS,EClDXK,EAAaC,IACzB,MAAMC,EAAkB,GAExB,GAAID,EAAW,CACd,MAAME,EAAWF,EAAUH,MAAM,MAAMM,QAAQC,IAAQA,EAAGC,YAAYP,WAAW,UAE7EI,EAASI,SACZL,EAAMM,KAAK,OACXL,EAASxB,SAAS0B,GAAOH,EAAMM,KAAK,MAAMH,OAC1CH,EAAMM,KAAK,OAEZ,CAED,OAAON,CAAK,EAGAO,EAAqBR,GACjCA,EACEH,MAAM,MACNM,QAAQxB,GAASA,EAAK0B,YAAYP,WAAW,UAC7CW,KAAK9B,GAASA,EAAK0B,YAAYnB,MAAM,KACrCwB,SAAS/B,IAETgC,ODSoClB,ECT9BjC,QAAMmB,GDUPc,EAAMmB,QAAO,CAACC,EAAKC,EAAMC,IACxBA,ECXa,GDWE,EACnB,IAAIF,EAAK,CAACC,IACV,IAAID,EAAI3B,MAAM,GAAI,GAAI,IAAI2B,EAAI3B,OAAO,GAAG,GAAI4B,KAC7C,KCbC5B,MAAM,GAAI,GACVuB,KACA,EAAEO,EAAMC,KACND,EAAgBrB,QAAQ,QAAS,IAClC,GAAGuB,EAAAA,UAAUD,QDIEN,IAAkBlB,CCHlC,IC7BQ0B,EAAoBA,CAChCC,EACAC,EAAuBrC,IACtBA,EAAKM,eAEN,IAAIgC,EAAU,cACVC,EAA2B,CAAC,IAChC,GAAmB,WAAfH,EAAMI,KACT,OAAQJ,EAAMK,MACb,IAAK,SACJH,EAAU,aACV,MACD,IAAK,MACJA,EAAU,aACVC,EAAehB,KAAK,SACpB,MACD,IAAK,SACJe,EAAU,aACV,MACD,IAAK,WACJA,EAAU,WACV,MACD,IAAK,QAGL,IAAK,UACJA,EAAU,aACV,MACD,IAAK,OACJA,EAAU,aACV,MACD,IAAK,UACJA,EAAU,cACV,MAED,IAAK,QACJA,EAAU,kBAGa,SAAfF,EAAMI,KAChBF,EAA0B,gBAAAF,EAAMK,QACP,WAAfL,EAAMI,OAChBF,EAAUD,EAAoBD,EAAMK,OAIZ,IAAAC,EDd+BC,EAOxB3B,ECchC,OARIoB,EAAMQ,QAAQL,EAAehB,KAAK,WAClCa,EAAMS,gBACTP,EAAkD,OAA3CI,EDdDC,OAAPA,EAAOnB,ECcwBY,EAAMS,eDbnCC,MAAMC,GAAaA,EAASjC,WAAW,mBADlC6B,EAAAA,EAEJzC,MAAM,GACPA,MAAM,GAAI,ICWuCwC,EAAIJ,EACtDC,EAAehB,SDTgBP,ECSSoB,EAAMS,cDRxCrB,EAAkBR,GAAWG,QAAQa,IAAUA,EAAKlB,WAAW,gBCUjEsB,EAAMY,YAA6B,SAAfZ,EAAMK,MAAiBF,EAAehB,KAAK,aAG7D,GAAGe,IAAUC,EAAeU,KAAK,MAAM,EC3BzCC,EAAsBC,IAC3B,MAAMC,EAAWC,OAAOC,KAAKH,GACvBnD,EAA2B,IAApBoD,EAAS9B,OAAe8B,EAAS,GAAK,KACnD,IAAKpD,EAAM,MAAM,IAAIuD,MAAM,yCAC3B,MAAO,CAACvD,EAAMmD,EAAInD,GAAM,ECvBzBwD,EAAAA,iBAAiB,CAChBC,WAAUA,KACF,CACNC,gBACAC,WAAY,cACZC,cAAe,QAGjBC,UAAAA,CAAWC,GACV,MAAMC,EAAU,IAAIC,EAAAA,QAEdC,EAASH,EAAQI,KAAKC,UAAUF,QAEhCG,WAAEA,GAAeN,EACjBO,EAAaP,EAAQQ,UAAUC,OAAQC,MACvCC,EAAaX,EAAQY,gBAAgB5B,MACzCd,GAAiC,qBAAxBA,EAAK2C,SAASH,QACtBD,OAAQC,MAELI,EAAUnG,EAAaoG,UAAUf,EAAQQ,UAAUQ,QACzD,IAAKF,EAAQG,QACZ,MAAM,IAAIxB,MACT,kFAGF,MAAMuB,EAASF,EAAQI,KACjBC,EAA+B,CACpCR,aACAJ,aACAD,cAGKc,EAAYnB,EAAQoB,oBACtBd,aACH,GACA,CAAEe,WAAW,IA0Bd,MCkNgCC,EAACpB,EAAsBiB,KACxDjB,EAAOvE,SAAS4F,GACfJ,EAAUK,qBAAqB,CAC9BC,qBAAsBF,EAAMtF,KAAKG,mBAElC,ED9OAkF,CAAmBpB,EAAQiB,GAE3BA,EAAUO,WAAW,CACpBC,WAAY,EACZC,qBAAqB,EACrBC,WAAYC,EAAmBA,oBAACC,SAGjC7B,EAAOvE,SAAS4F,IACf,MAAMS,EAAahC,EAAQoB,iBACvB,GAAAd,KAAciB,EAAMtF,KAAKG,mBAC5B,CAAA,EACA,CAAEiF,WAAW,IC8MgBY,EAChCV,EACAS,EACAjB,EACAG,KAjQmCgB,EACnCX,EACAS,EACAjB,GACEV,aAAYC,aAAYI,iBAE1B,MAAMpE,iBAAEA,EAAgBD,UAAEA,GAAcN,EAAcgF,GAChDoB,EAA2C,CAChD,CACC1D,KAAM2D,EAAaA,cAACC,kBACpBC,gBAAiB,IACjBb,gBAAiB,QAIfV,EAAO3F,SACV+G,EAAW3E,KAAK,CACfiB,KAAM2D,EAAaA,cAACC,kBACpBC,gBAAiB,UACjBb,gBAAiBhF,EAChB8F,EAAAA,QAAKC,SAASlC,EAAYiC,EAAAA,QAAKE,QAAQF,EAAI,QAACG,QAAQrC,GAAaU,EAAO3F,aAKvE2F,EAAO5F,cAAgBoG,EAAMoB,OAAOC,MAAMC,GAAiB,YAAXA,EAAEnE,QACrDyD,EAAW3E,KAAK,CACfiB,KAAM2D,EAAaA,cAACC,kBACpBS,aAAc,CAAC,WACfrB,gBAAiB,eAInB,MAAMsB,EAAaxB,EAAMoB,OAAOvF,QAAQyF,GAAiB,SAAXA,EAAEpE,OAC1CuE,EAAiBzB,EAAMoB,OAAOvF,QAAQyF,GAAiB,WAAXA,EAAEpE,OAC9CwE,EAAeV,EAAI,QAACC,SAASlC,EAAYI,GAW/C,GATIqC,EAAWxF,OAAS,GACvB4E,EAAW3E,KAAK,CACfiB,KAAM2D,EAAaA,cAACC,kBACpBa,WAAkC,IAAtBH,EAAWxF,OACvBkE,gBAAiBhF,EAASwG,GAC1BH,aAAcC,EAAWrF,KAAKmF,GAAMA,EAAEnE,UAIX,IAAzBqC,EAAOnG,eAA2BoI,EAAezF,OAAS,EAAG,CAChE,MAAM4F,EAAiBH,EAAe5F,QAAQyF,GAAMA,EAAEnE,OAAS6C,EAAMtF,OAEjEkH,EAAe5F,OAAS,GAC3B4E,EAAW3E,KAAK,CACfiB,KAAM2D,EAAaA,cAACC,kBACpBZ,gBAAiB,UACjBqB,aAAcM,MAAMC,KACnB,IAAIC,IACHH,EAAexF,SAASkF,GAAM,CAC7BxG,EAAUwG,EAAEnE,MACD,WAAAmE,EAAEnE,OACbpC,EAAiBuG,EAAEnE,YAMxB,CAEDsD,EAAWuB,sBAAsBpB,EAAW,EAiM5CD,CAAqBX,EAAOS,EAAYjB,EAAQG,GA9LTsC,EACvCjC,EACAS,EACAjB,EACA0C,KAEIlC,EAAMoB,OAAOC,MAAMC,GAAiB,SAAXA,EAAEnE,QAC9BsD,EAAW0B,eAAelI,IACzBA,EAAOE,UACPH,EAAWC,EAAQ,CAClB,mCAEC,4CAAAuF,EAAOzF,sBAAwB,GAAK,UAErC,yDAEC,qEAAAyF,EAAOzF,sBAAwB,GAAK,iBAErC,2HACC,IAIAyF,EAAO5F,cAAgBoG,EAAMoB,OAAOC,MAAMC,GAAiB,YAAXA,EAAEnE,QACrDsD,EAAW0B,eAAelI,IACzBA,EAAOE,UACPH,EAAWC,EAAQ,CAClB,sCACA,IACA,uBACA,kBACA,kBACA,uBACA,UACA,iCACA,sBACA,oBACA,MACA,KACA,8CACC,GAEH,EAqJDgI,CAAyBjC,EAAOS,EAAYjB,GAlJP4C,EACrCpC,EACAS,EACAjB,EACA0C,KAEA,MAAMpH,UAAEA,GAAcN,EAAcgF,GAEpCiB,EAAW4B,qBAAqB,CAC/BC,gBAAiBC,EAAuBA,wBAACC,MACzCC,YAAY,EACZC,cAAgBzI,GAAWA,EAAO0I,qBAClCC,aAAc,CACb,CACClI,KAAMI,EAAUkF,EAAMtF,MACtBmI,WAAAA,CAAY5I,GACXA,EACEK,MAAM,aACNwI,aAAY,KACZ9C,EAAMoB,OACJvF,QAAQyF,GAAiB,WAAXA,EAAEpE,OAChB9C,SAAS0C,IACT9C,EAAWC,EAAQwB,EAAUqB,EAAMS,gBACnCtD,EACEK,MAAS,GAAAwC,EAAMpC,SAASmC,EAAkBC,MAC1CxC,MAAM,KACNH,SAAS,GACV,IAEHG,MAAM,IACT,KAGD,EAkHF8H,CAAuBpC,EAAOS,EAAYjB,GLlPVuD,EAAC/C,EAAmBR,IACpDQ,EAAMoB,OAAOC,MAAMvE,GAAyB,WAAfA,EAAMI,SAA+C,IAAzBsC,EAAOnG,cKkP5D0J,CAAkB/C,EAAOR,KAhHewD,EAC5ChD,EACAS,EACAjB,EACA0C,KAEA,MAAMpH,UAAEA,EAASC,iBAAEA,GAAqBP,EAAcgF,GAEhDiC,EAAiBzB,EAAMoB,OAAOvF,QAAQyF,GAAiB,WAAXA,EAAEpE,OAEpDuD,EAAWwC,aAAa,CACvBvI,KAAM,WAAWsF,EAAMtF,OACvB+H,YAAY,EACZS,QAAS,CAAC,kBAAkBpI,EAAUkF,EAAMtF,UAC5CyI,WAAY1B,EAAetF,KAAKmF,IAAO,CACtC8B,kBAAmB9B,EAAE5D,WACrBhD,KAAM4G,EAAE5G,KACRyC,KAAM,WAAWmE,EAAEnE,OAAOmE,EAAEhE,OAAS,KAAO,KAAMgE,EAAE5D,WAAyB,GAAZ,kBAInE+C,EAAW0B,eAAelI,GACzBD,EAAWC,EAAQ,CAClB,GACA,MACA,MAAMc,EACLiF,EAAMtF,wEAEP,KACA,kFACA,UAIF+F,EAAW4B,qBAAqB,CAC/BC,gBAAiBC,EAAuBA,wBAACC,MACzCC,YAAY,EACZG,aAAc,CACb,CACClI,KAAMK,EAAiBiF,EAAMtF,MAC7ByC,KAAM,uBAAuB6C,EAAMtF,QACnCmI,WAAAA,CAAY5I,GACXA,EACEK,sBAAsBQ,EAAUkF,EAAMtF,iBACtCoI,aAAY,KACZrB,EAAerH,SAAS0C,IACvB9C,EAAWC,EAAQwB,EAAUqB,EAAMS,gBAEnCtD,EACEK,MACA,GAAGwC,EAAMpC,SAASmC,EACjBC,EACA/B,MAGDT,MAAM,KACNH,SAAS,GACV,IAEFG,MAAM,KACT,KAGD,EAkDD0I,CAA8BhD,EAAOS,EAAYjB,GA/CA6D,EAClDrD,EACAS,EACAjB,EACA0C,KAEA,MAAMpH,UAAEA,EAASG,uBAAEA,GAA2BT,EAAcgF,GAEtDiC,EAAiBzB,EAAMoB,OAAOvF,QAAQyF,GAAiB,WAAXA,EAAEpE,OAEpDuD,EAAW4B,qBAAqB,CAC/BC,gBAAiBC,EAAuBA,wBAACC,MACzCC,YAAY,EACZG,aAAc,CACb,CACClI,KAAMO,EAAuB+E,EAAMtF,MACnCmI,WAAAA,CAAY5I,GACXA,EAAO6I,aAAY,KAClBrB,EAAerH,SAAS0C,IACvB9C,EAAWC,EAAQwB,EAAUqB,EAAMS,gBAEnCtD,EACEK,MACG,GAAAwC,EAAMpC,mBAAmBI,EAAUgC,EAAMK,mBAC3CL,EAAMQ,OAAS,OAAS,YAGzBhD,MAAM,KACNH,SAAS,GACV,GAEJ,KAGD,EAcDkJ,CAAoCrD,EAAOS,EAAYjB,GACvD,EDxNCkB,CAAkBV,EAAOS,EAAYjB,EAAQG,GAE7Cc,EAAWN,WAAW,CACrBC,WAAY,EACZC,qBAAqB,EACrBC,WAAYC,EAAmBA,oBAACC,QAC/B,IAGI/B,EAAQ6E,MAChB,mCDrEeC,EACfC,EACAC,EACAnI,GAEA,MAAOoI,GAAe9F,EAAmB6F,GACnC/D,EA2BmBiE,EAACH,EAAcE,KACxC,MAAME,EAAkBJ,EAAQE,GAE1BG,EAAiBD,EAAgBE,KAAKC,QACtCC,EAAuBjG,OAAOC,KAAK6F,GAEnCI,EAA4BT,kBAAwBE,KACpDQ,EAFqBV,YAAkBE,KAEPI,KAAKK,SAASL,KAAKC,QAGzD,MAAO,CACNH,kBACAM,aACAE,WALkBC,EAAC,QAACC,KAAKJ,EAAYF,GAMrCO,cALqBF,EAAC,QAACG,KAAKN,EAAYF,GAMxCC,4BACA,EA3CYN,CAAkBH,EAASE,GACxC,IAAIe,EAAa/E,EAAK0E,WAgBtB,OAfArG,OAAO2G,QAAQpJ,GAAUlB,SAAQ,EAAEuK,EAAKC,MAAO,IAAAC,EAC9C,IAAKnF,EAAKuE,0BAA0Ba,eAAeH,GAAM,OACzD,MAAOI,GAAgBnH,SAAkBiH,EAACnF,EAAKuE,0BAA0BU,WAA/BE,EAAqCd,OAC7D,kBAAPa,EACVH,EAAWE,GAAOjF,EAAKuE,0BAA0BU,GAAKzK,MACnDsJ,EAAQuB,GAAc7K,QACtBsJ,EAAQuB,GACa,iBAAPH,IACjBH,EAAWE,GAAOpB,EACjBC,EACA,CAAEuB,CAACA,GAAevB,EAAQuB,IAC1BzJ,EAASqJ,GAAKK,SAEf,IAEKnM,EAAC,QAACO,OAAOqL,EACjB"}