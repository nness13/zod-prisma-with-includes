"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=require("@prisma/generator-helper"),t=require("typescript"),a=require("zod"),r=require("path"),i=require("ts-morph"),n=require("parenthesis"),o=require("lodash");function l(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var s=l(r),c=l(o);const d=a.z.enum(["true","false"]).transform((e=>JSON.parse(e))),m=a.z.object({relationModel:d.default("true").or(a.z.literal("default")),modelSuffix:a.z.string().default("Model"),modelCase:a.z.enum(["PascalCase","camelCase"]).default("PascalCase"),useDecimalJs:d.default("false"),imports:a.z.string().optional(),prismaJsonNullability:d.default("true")}),u=(e,t,a=!0)=>t.forEach((t=>e.write(t).conditionalNewLine(a))),p=({modelCase:e,modelSuffix:t,relationModel:a})=>{const r=(a,r="")=>("camelCase"===e&&(a=a.slice(0,1).toLowerCase()+a.slice(1)),`${r}${a}${t}`);return{modelName:e=>r(e,"default"===a?"_":""),relatedModelName:e=>r("default"===a?e.toString():`Related${e.toString()}`),simpleRelatedModelName:e=>r("default"===a?`Simple${e.toString()}`:`SimpleRelated${e.toString()}`)}},f=e=>{const t=e.replace(/^\\\\\?\\/,"").replace(/\\/g,"/").replace(/\/\/+/g,"/");return t.includes("/node_modules/")?t.split("/node_modules/").slice(-1)[0]:t.startsWith("../")?t:"./"+t},h=e=>{const t=[];if(e){const a=e.split("\n").filter((e=>!e.trimStart().startsWith("@zod")));a.length&&(t.push("/**"),a.forEach((e=>t.push(` * ${e}`))),t.push(" */"))}return t},z=e=>e.split("\n").filter((e=>e.trimStart().startsWith("@zod"))).map((e=>e.trimStart().slice(4))).flatMap((e=>{return(t=n.parse(e),t.reduce(((e,t,a)=>a%2==0?[...e,[t]]:[...e.slice(0,-1),[...e.slice(-1)[0],t]]),[])).slice(0,-1).map((([e,t])=>e.replace(/\)?\./,"")+`${n.stringify(t)})`));var t})),y=(e,t=(e=>e.toString()))=>{let a="z.unknown()",r=[""];if("scalar"===e.kind)switch(e.type){case"String":a="z.string()";break;case"Int":a="z.number()",r.push("int()");break;case"BigInt":a="z.bigint()";break;case"DateTime":a="z.date()";break;case"Float":case"Decimal":a="z.number()";break;case"Json":a="jsonSchema";break;case"Boolean":a="z.boolean()";break;case"Bytes":a="z.unknown()"}else"enum"===e.kind?a=`z.nativeEnum(${e.type})`:"object"===e.kind&&(a=t(e.type));var i,n,o;return e.isList&&r.push("array()"),e.documentation&&(a=null!=(i=null==(n=z(e.documentation).find((e=>e.startsWith("custom("))))?void 0:n.slice(7).slice(0,-1))?i:a,r.push(...(o=e.documentation,z(o).filter((e=>!e.startsWith("custom(")))))),e.isRequired||"Json"===e.type||r.push("nullish()"),`${a}${r.join(".")}`},S=e=>{const t=Object.keys(e),a=1===t.length?t[0]:null;if(!a)throw new Error("schemaObj must contain one property");return[a,e[a]]};e.generatorHandler({onManifest:()=>({version:"0.5.4",prettyName:"Zod Schemas",defaultOutput:"zod"}),onGenerate(e){const a=new i.Project,r=e.dmmf.datamodel.models,{schemaPath:n}=e,o=e.generator.output.value,l=e.otherGenerators.find((e=>"prisma-client-js"===e.provider.value)).output.value,c=m.safeParse(e.generator.config);if(!c.success)throw new Error("Incorrect config provided. Please check the values you provided and try again.");const d=c.data,z={clientPath:l,outputPath:o,schemaPath:n},S=a.createSourceFile(`${o}/index.ts`,{},{overwrite:!0});return((e,t)=>{e.forEach((e=>t.addExportDeclaration({moduleSpecifier:`./${e.name.toLowerCase()}`})))})(r,S),S.formatText({indentSize:2,convertTabsToSpaces:!0,semicolons:t.SemicolonPreference.Remove}),r.forEach((e=>{const r=a.createSourceFile(`${o}/${e.name.toLowerCase()}.ts`,{},{overwrite:!0});((e,t,a,r)=>{((e,t,a,{schemaPath:r,outputPath:n,clientPath:o})=>{const{relatedModelName:l,modelName:c}=p(a),d=[{kind:i.StructureKind.ImportDeclaration,namespaceImport:"z",moduleSpecifier:"zod"}];a.imports&&d.push({kind:i.StructureKind.ImportDeclaration,namespaceImport:"imports",moduleSpecifier:f(s.default.relative(n,s.default.resolve(s.default.dirname(r),a.imports)))}),a.useDecimalJs&&e.fields.some((e=>"Decimal"===e.type))&&d.push({kind:i.StructureKind.ImportDeclaration,namedImports:["Decimal"],moduleSpecifier:"decimal.js"});const m=e.fields.filter((e=>"enum"===e.kind)),u=e.fields.filter((e=>"object"===e.kind)),h=s.default.relative(n,o);if(m.length>0&&d.push({kind:i.StructureKind.ImportDeclaration,isTypeOnly:0===m.length,moduleSpecifier:f(h),namedImports:m.map((e=>e.type))}),!1!==a.relationModel&&u.length>0){const t=u.filter((t=>t.type!==e.name));t.length>0&&d.push({kind:i.StructureKind.ImportDeclaration,moduleSpecifier:"./index",namedImports:Array.from(new Set(t.flatMap((e=>[c(e.type),`Complete${e.type}`,l(e.type)]))))})}t.addImportDeclarations(d)})(e,t,a,r),((e,t,a,r)=>{e.fields.some((e=>"Json"===e.type))&&t.addStatements((e=>{e.newLine(),u(e,["// Helper schema for JSON fields","type Literal = boolean | number | string"+(a.prismaJsonNullability?"":"| null"),"type Json = Literal | { [key: string]: Json } | Json[]",`const literalSchema = z.union([z.string(), z.number(), z.boolean()${a.prismaJsonNullability?"":", z.null()"}])`,"const jsonSchema: z.ZodSchema<Json> = z.lazy(() => z.union([literalSchema, z.array(jsonSchema), z.record(jsonSchema)]))"])})),a.useDecimalJs&&e.fields.some((e=>"Decimal"===e.type))&&t.addStatements((e=>{e.newLine(),u(e,["// Helper schema for Decimal fields","z",".instanceof(Decimal)",".or(z.string())",".or(z.number())",".refine((value) => {","  try {","    return new Decimal(value);","  } catch (error) {","    return false;","  }","})",".transform((value) => new Decimal(value));"])}))})(e,t,a),((e,t,a,r)=>{const{modelName:n}=p(a);t.addVariableStatement({declarationKind:i.VariableDeclarationKind.Const,isExported:!0,leadingTrivia:e=>e.blankLineIfLastNot(),declarations:[{name:n(e.name),initializer(t){t.write("z.object(").inlineBlock((()=>{e.fields.filter((e=>"object"!==e.kind)).forEach((e=>{u(t,h(e.documentation)),t.write(`${e.name}: ${y(e)}`).write(",").newLine()}))})).write(")")}}]})})(e,t,a),((e,t)=>e.fields.some((e=>"object"===e.kind))&&!1!==t.relationModel)(e,a)&&(((e,t,a,r)=>{const{modelName:n,relatedModelName:o}=p(a),l=e.fields.filter((e=>"object"===e.kind));t.addInterface({name:`Complete${e.name}`,isExported:!0,extends:[`z.infer<typeof ${n(e.name)}>`],properties:l.map((e=>({hasQuestionToken:!e.isRequired,name:e.name,type:`Complete${e.type}${e.isList?"[]":""}${e.isRequired?"":" | null"}`})))}),t.addStatements((t=>u(t,["","/**",` * ${o(e.name)} contains all relations on your model in addition to the scalars`," *"," * NOTE: Lazy required in case of potential circular dependencies within schema"," */"]))),t.addVariableStatement({declarationKind:i.VariableDeclarationKind.Const,isExported:!0,declarations:[{name:o(e.name),type:`z.ZodSchema<Complete${e.name}>`,initializer(t){t.write(`z.lazy(() => ${n(e.name)}.extend(`).inlineBlock((()=>{l.forEach((e=>{u(t,h(e.documentation)),t.write(`${e.name}: ${y(e,o)}`).write(",").newLine()}))})).write("))")}}]})})(e,t,a),((e,t,a,r)=>{const{modelName:n,simpleRelatedModelName:o}=p(a),l=e.fields.filter((e=>"object"===e.kind));t.addVariableStatement({declarationKind:i.VariableDeclarationKind.Const,isExported:!0,declarations:[{name:o(e.name),initializer(e){e.inlineBlock((()=>{l.forEach((t=>{u(e,h(t.documentation)),e.write(`${t.name}: {shape: { ${n(t.type)} }, array: ${t.isList?"true":"false"}}`).write(",").newLine()}))}))}}]})})(e,t,a))})(e,r,d,z),r.formatText({indentSize:2,convertTabsToSpaces:!0,semicolons:t.SemicolonPreference.Remove})})),a.save()}}),exports.with_includes=function e(t,r,i){const[n]=S(r),o=((e,t)=>{const a=e[t],r=a._def.shape(),i=Object.keys(r),n=e[`SimpleRelated${t}`],o=e[`Related${t}`]._def.getter()._def.shape();return{core_zod_schema:a,full_shape:o,core_shape:c.default.pick(o,i),related_shape:c.default.omit(o,i),simple_related_zod_schema:n}})(t,n);let l=o.core_shape;return Object.entries(i).forEach((([a,r])=>{var n;if(!o.simple_related_zod_schema.hasOwnProperty(a))return;const[s]=S(null==(n=o.simple_related_zod_schema[a])?void 0:n.shape);"boolean"==typeof r?l[a]=o.simple_related_zod_schema[a].array?t[s].array():t[s].optional():"object"==typeof r&&(l[a]=o.simple_related_zod_schema[a].array?e(t,{[s]:t[s]},i[a].include).array():e(t,{[s]:t[s]},i[a].include).optional())})),a.z.object(l)};
//# sourceMappingURL=zod-prisma-with-includes.cjs.production.min.js.map
